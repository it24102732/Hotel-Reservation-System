<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Menu - Hotel Paradise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c5242; /* Deep Green */
            --secondary-color: #d4a373; /* Earthy Gold */
            --background-color: #ffffff; /* Creamy White */
            --text-color: #3d405b;
            --light-gray: #e5e7eb;
            --border-radius: 1rem;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
        }

        /* --- MODIFICATION: Updated Navbar Style --- */
        .navbar {
            background: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .navbar .nav-link.active {
            color: var(--primary-color) !important;
            font-weight: 600;
        }

        .food-header {
            background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1555939594-58d7cb561ad1?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1974&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 4rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }

        .food-header h1 {
            font-family: 'Playfair Display', serif;
        }

        .category-pills {
            padding: 0;
            margin-bottom: 2rem;
        }

        .category-pill {
            padding: 0.6rem 1.25rem;
            border-radius: 25px;
            border: 2px solid var(--light-gray);
            background: white;
            color: var(--text-color);
            font-weight: 600;
            transition: all 0.3s;
        }

        .category-pill:hover, .category-pill.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(44, 82, 66, 0.2);
        }

        .menu-item-card {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: all 0.3s;
            height: 100%;
            border: 1px solid var(--light-gray);
            cursor: pointer;
        }

        .menu-item-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.1);
        }

        .menu-item-image-container { height: 220px; overflow: hidden; }
        .menu-item-image-container img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .menu-item-card:hover .menu-item-image-container img { transform: scale(1.05); }
        .placeholder-image { width: 100%; height: 100%; background-color: var(--light-gray); display: flex; align-items: center; justify-content: center; font-size: 3rem; color: var(--primary-color); }
        .menu-item-body { padding: 1.5rem; }
        .price-tag { font-size: 1.75rem; font-weight: 800; color: var(--primary-color); font-family: 'Playfair Display', serif; }

        /* --- MODIFICATION: Cart UI Styles --- */
        .cart-sidebar { position: fixed; right: -450px; top: 0; width: 450px; height: 100vh; background: white; box-shadow: -5px 0 15px rgba(0,0,0,0.1); transition: right 0.4s ease; z-index: 1050; display: flex; flex-direction: column; }
        .cart-sidebar.open { right: 0; }
        .cart-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 1040; }
        .cart-overlay.show { display: block; }
        .cart-header { background: var(--primary-color); color: white; padding: 1.5rem; }
        .cart-body { overflow-y: auto; flex-grow: 1; padding: 0.5rem; }
        .cart-item { border-bottom: 1px solid var(--light-gray); padding: 1rem; display: flex; flex-direction: column; }
        .cart-footer { background: white; padding: 1.5rem; border-top: 2px solid var(--light-gray); box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .cart-toggle { position: fixed; bottom: 2rem; right: 2rem; width: 65px; height: 65px; border-radius: 50%; background: var(--primary-color); color: white; border: none; box-shadow: 0 4px 15px rgba(44, 82, 66, 0.4); font-size: 1.75rem; z-index: 1030; transition: all 0.3s; }
        .cart-toggle:hover { transform: scale(1.1); }
        .cart-badge { position: absolute; top: -5px; right: -5px; background: var(--secondary-color); color: white; width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 700; border: 2px solid white; }
        .quantity-control { display: flex; align-items: center; gap: 0.75rem; }
        .quantity-btn { width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--light-gray); background: white; cursor: pointer; transition: all 0.2s; }
        .quantity-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }
        .btn-checkout { background-color: var(--primary-color); color: white; font-weight: 600; padding: 0.75rem; transition: background-color 0.2s; }
        .btn-checkout:hover { background-color: #1e3a2f; color: white; }

        /* Modal Styles */
        .modal-content { border-radius: var(--border-radius); border: none; }
        .modal-header { background-color: var(--primary-color); color: white; border-bottom: none; }
        .modal-header .btn-close { filter: invert(1) grayscale(100%) brightness(200%); }
        .modal-body img { width: 100%; height: 300px; object-fit: cover; border-radius: var(--border-radius); }
        #modalItemPrice { font-size: 2rem; font-weight: 700; color: var(--primary-color); font-family: 'Playfair Display', serif; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
        <a class="navbar-brand fw-bold" th:href="@{/customer/dashboard}">
            <i class="fas fa-hotel" style="color: var(--primary-color);"></i>
            <span class="ms-2">Hotel Paradise</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" th:href="@{/customer/dashboard}"><i class="fas fa-home me-1"></i>Dashboard</a></li>
                <li class="nav-item"><a class="nav-link active" th:href="@{/customer/food-order/menu}"><i class="fas fa-utensils me-1"></i>Food Menu</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/customer/food-order/history}"><i class="fas fa-history me-1"></i>Order History</a></li>
                <li class="nav-item"><a class="nav-link" th:href="@{/customer/wallet}"><i class="fas fa-wallet me-1"></i>My Wallet</a></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-circle me-1"></i> <span th:text="${session.userName}">User</span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" th:href="@{/logout}"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="food-header">
    <div class="container">
        <h1 class="display-4 fw-bold mb-2"><i class="fas fa-utensils me-3"></i>Exquisite Dining</h1>
        <p class="lead mb-0">Discover our collection of delicious meals, delivered fresh to your room.</p>
    </div>
</div>

<div class="container mb-5">
    <div class="category-pills">
        <div class="d-flex flex-wrap gap-2">
            <a th:href="@{/customer/food-order/menu(category='all')}" class="category-pill text-decoration-none" th:classappend="${selectedCategory == 'all'} ? 'active' : ''"><i class="fas fa-th-large me-2"></i>All</a>
            <a th:each="cat : ${categories}" th:href="@{/customer/food-order/menu(category=${cat})}" class="category-pill text-decoration-none" th:classappend="${selectedCategory == cat} ? 'active' : ''" th:text="${cat}"></a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-md-6 col-lg-4" th:each="item : ${menuItems}">
            <div class="menu-item-card"
                 data-bs-toggle="modal"
                 data-bs-target="#menuItemModal"
                 th:data-id="${item.id}"
                 th:data-name="${item.name}"
                 th:data-description="${item.description}"
                 th:data-price="${item.price}"
                 th:data-image-url="${item.imageUrl}"
                 th:data-category="${item.category}">

                <div class="menu-item-image-container">
                    <th:block th:if="${item.imageUrl != null and !item.imageUrl.isEmpty()}">
                        <img th:src="${item.imageUrl}" th:alt="${item.name}">
                    </th:block>
                    <th:block th:unless="${item.imageUrl != null and !item.imageUrl.isEmpty()}">
                        <div class="placeholder-image"><i class="fas fa-utensils"></i></div>
                    </th:block>
                </div>

                <div class="menu-item-body">
                    <h5 class="fw-bold mb-2" th:text="${item.name}"></h5>
                    <p class="text-muted small mb-3" th:text="${#strings.abbreviate(item.description, 80)}"></p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="price-tag">$<span th:text="${#numbers.formatDecimal(item.price, 1, 2)}"></span></span>
                        <span class="badge rounded-pill text-bg-light fw-semibold" th:text="${item.category}"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<button class="cart-toggle" onclick="toggleCart()" th:if="${cart != null and !cart.isEmpty()}">
    <i class="fas fa-shopping-cart"></i>
    <span class="cart-badge" th:text="${cartItemCount}">0</span>
</button>

<div class="cart-overlay" id="cartOverlay" onclick="toggleCart()"></div>

<div class="cart-sidebar" id="cartSidebar">
    <div class="cart-header">
        <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fas fa-shopping-cart me-2"></i>Your Cart</h4>
            <button class="btn btn-close btn-close-white" onclick="toggleCart()"></button>
        </div>
    </div>
    <div class="cart-body">
        <div th:if="${cart != null and !cart.isEmpty()}">
            <div class="cart-item" th:each="entry : ${cart}">
                <div class="d-flex justify-content-between mb-2">
                    <strong th:text="${entry.value.menuItem.name}"></strong>
                    <span class="fw-bold" style="color: var(--primary-color);">$<span th:text="${#numbers.formatDecimal(entry.value.subtotal, 1, 2)}"></span></span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="quantity-control">
                        <form th:action="@{/customer/food-order/cart/update}" method="post" class="d-inline">
                            <input type="hidden" name="itemId" th:value="${entry.key}"><input type="hidden" name="quantity" th:value="${entry.value.quantity - 1}">
                            <button type="submit" class="quantity-btn" th:disabled="${entry.value.quantity <= 1}"><i class="fas fa-minus"></i></button>
                        </form>
                        <span class="fw-bold" th:text="${entry.value.quantity}"></span>
                        <form th:action="@{/customer/food-order/cart/update}" method="post" class="d-inline">
                            <input type="hidden" name="itemId" th:value="${entry.key}"><input type="hidden" name="quantity" th:value="${entry.value.quantity + 1}">
                            <button type="submit" class="quantity-btn"><i class="fas fa-plus"></i></button>
                        </form>
                    </div>
                    <form th:action="@{/customer/food-order/cart/remove}" method="post" class="d-inline">
                        <input type="hidden" name="itemId" th:value="${entry.key}">
                        <button type="submit" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </form>
                </div>
            </div>
        </div>
        <div th:if="${cart == null or cart.isEmpty()}" class="text-center py-5"><i class="fas fa-shopping-cart text-muted" style="font-size: 3rem;"></i><p class="mt-3 text-muted">Your cart is empty</p></div>
    </div>
    <div class="cart-footer" th:if="${cart != null and !cart.isEmpty()}">
        <div class="d-flex justify-content-between mb-3"><strong>Total:</strong><strong class="fs-4" style="color: var(--primary-color);">$<span th:text="${#numbers.formatDecimal(cartTotal, 1, 2)}"></span></strong></div>
        <a th:href="@{/customer/food-order/checkout}" class="btn btn-checkout w-100 mb-2"><i class="fas fa-check-circle me-2"></i>Proceed to Checkout</a>
        <form th:action="@{/customer/food-order/cart/clear}" method="post"><button type="submit" class="btn btn-outline-danger w-100" onclick="return confirm('Clear entire cart?')"><i class="fas fa-trash me-2"></i>Clear Cart</button></form>
    </div>
</div>

<div class="modal fade" id="menuItemModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalItemName">Item Name</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-4">
                    <div class="col-md-6"><img src="" id="modalItemImage" alt="Menu Item Image"></div>
                    <div class="col-md-6 d-flex flex-column">
                        <p id="modalItemDescription" class="text-muted"></p>
                        <div class="mt-auto">
                            <span class="badge rounded-pill text-bg-light fw-semibold mb-3" id="modalItemCategory"></span>
                            <div class="d-flex justify-content-between align-items-center">
                                <span id="modalItemPrice">$0.00</span>
                                <form th:action="@{/customer/food-order/cart/add}" method="post" id="modalCartForm">
                                    <input type="hidden" name="itemId" id="modalItemId">
                                    <div class="input-group">
                                        <span class="input-group-text">Qty</span>
                                        <input type="number" name="quantity" class="form-control" value="1" min="1" max="10" style="max-width: 70px;">
                                        <button type="submit" class="btn btn-dark"><i class="fas fa-cart-plus"></i> Add</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- MODIFICATION: Added Cart Toggle Function ---
    function toggleCart() {
        document.getElementById('cartSidebar').classList.toggle('open');
        document.getElementById('cartOverlay').classList.toggle('show');
    }

    // Modal Javascript from previous step (correct)
    const menuItemModal = document.getElementById('menuItemModal');
    menuItemModal.addEventListener('show.bs.modal', event => {
        const card = event.relatedTarget;
        const id = card.getAttribute('data-id');
        const name = card.getAttribute('data-name');
        const description = card.getAttribute('data-description');
        const price = parseFloat(card.getAttribute('data-price')).toFixed(2);
        const imageUrl = card.getAttribute('data-image-url');
        const category = card.getAttribute('data-category');

        menuItemModal.querySelector('#modalItemName').textContent = name;
        menuItemModal.querySelector('#modalItemDescription').textContent = description;
        menuItemModal.querySelector('#modalItemPrice').textContent = `$${price}`;
        menuItemModal.querySelector('#modalItemCategory').textContent = category;
        menuItemModal.querySelector('#modalItemId').value = id;

        const modalImage = menuItemModal.querySelector('#modalItemImage');
        if (imageUrl && imageUrl !== 'null' && imageUrl.trim() !== '') {
            modalImage.src = imageUrl;
        } else {
            modalImage.src = "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?auto=format&fit=crop&q=60"; // A nice default placeholder
        }
    });
</script>
</body>
</html>