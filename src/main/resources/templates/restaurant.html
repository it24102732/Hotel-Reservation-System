<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Management - Hotel Paradise</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/restaurant.css}">
</head>
<body>
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="border-end bg-dark text-white" id="sidebar-wrapper">
        <div class="sidebar-heading p-3">
            <i class="fas fa-hotel me-2"></i>Hotel Paradise
        </div>
        <div class="list-group list-group-flush">
            <a class="list-group-item list-group-item-action bg-primary text-white p-3" th:href="@{/restaurant}">
                <i class="fas fa-utensils me-2"></i>Restaurant
            </a>
            <a class="list-group-item list-group-item-action bg-transparent text-white p-3" th:href="@{/logout}">
                <i class="fas fa-sign-out-alt me-2"></i>Logout
            </a>
        </div>
    </div>

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
            <div class="container-fluid">
                <form method="get" th:action="@{/restaurant}">
                    <button type="submit" class="btn btn-primary" name="toggleSidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                </form>
                <h5 class="ms-3 mb-0">Restaurant Management</h5>
            </div>
        </nav>

        <div class="container-fluid p-4">
            <!-- Flash Messages -->
            <div th:if="${successMessage}" class="alert alert-success alert-dismissible">
                <i class="fas fa-check-circle me-2"></i><span th:text="${successMessage}"></span>
                <form method="get" th:action="@{/restaurant}" class="d-inline">
                    <button type="submit" class="btn-close"></button>
                </form>
            </div>

            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible">
                <i class="fas fa-exclamation-circle me-2"></i><span th:text="${errorMessage}"></span>
                <form method="get" th:action="@{/restaurant}" class="d-inline">
                    <button type="submit" class="btn-close"></button>
                </form>
            </div>

            <!-- Dashboard Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-start-primary shadow h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs text-uppercase mb-1 text-primary fw-bold">Pending Orders</div>
                                    <div class="h2 mb-0 fw-bold" th:text="${statistics.pendingOrders} ?: 0">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-clock fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-start-success shadow h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs text-uppercase mb-1 text-success fw-bold">Today's Orders</div>
                                    <div class="h2 mb-0 fw-bold" th:text="${statistics.todayOrders} ?: 0">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-start-info shadow h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs text-uppercase mb-1 text-info fw-bold">Menu Items</div>
                                    <div class="h2 mb-0 fw-bold" th:text="${menuItems != null ? #lists.size(menuItems) : 0}">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-start-warning shadow h-100">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col">
                                    <div class="text-xs text-uppercase mb-1 text-warning fw-bold">Today's Revenue</div>
                                    <div class="h2 mb-0 fw-bold">rs<span th:text="${statistics.todayRevenue != null ? #numbers.formatDecimal(statistics.todayRevenue, 0, 2) : '0.00'}">0.00</span></div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Food Orders Section -->
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 fw-bold text-primary">
                        <i class="fas fa-utensils me-2"></i>Live Food Orders
                    </h6>
                    <form th:action="@{/restaurant}" method="get">
                        <select name="orderStatus" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="ALL" th:selected="${currentOrderFilter == 'ALL'}">All Orders</option>
                            <option value="PENDING" th:selected="${currentOrderFilter == 'PENDING'}">Pending</option>
                            <option value="PREPARING" th:selected="${currentOrderFilter == 'PREPARING'}">Preparing</option>
                            <option value="DELIVERED" th:selected="${currentOrderFilter == 'DELIVERED'}">Delivered</option>
                            <option value="CANCELLED" th:selected="${currentOrderFilter == 'CANCELLED'}">Cancelled</option>
                        </select>
                    </form>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                            <tr>
                                <th>Order ID</th>
                                <th>Room</th>
                                <th>Items</th>
                                <th>Total</th>
                                <th>Status</th>
                                <th>Time</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${orders == null || #lists.isEmpty(orders)}">
                                <td colspan="7" class="text-center py-4">
                                    <i class="fas fa-inbox fa-3x text-muted"></i>
                                    <p class="text-muted mt-2">No orders found</p>
                                </td>
                            </tr>
                            <tr th:each="order : ${orders}">
                                <td><strong>#<span th:text="${order.id}"></span></strong></td>
                                <td>
                                    <span class="badge bg-secondary">
                                        <i class="fas fa-door-open me-1"></i>
                                        <span th:text="${order.room.roomNumber}"></span>
                                    </span>
                                </td>
                                <td><span th:text="${#strings.listJoin(order.items.![name], ', ')}"></span></td>
                                <td><strong class="text-success">$<span th:text="${#numbers.formatDecimal(order.totalPrice, 0, 2)}"></span></strong></td>
                                <td>
                                    <span class="badge"
                                          th:classappend="${order.status == 'PENDING' ? 'bg-warning' : (order.status == 'PREPARING' ? 'bg-primary' : (order.status == 'DELIVERED' ? 'bg-success' : 'bg-danger'))}"
                                          th:text="${order.status}"></span>
                                </td>
                                <td class="small" th:text="${#temporals.format(order.orderedAt, 'MMM dd, HH:mm')}"></td>
                                <td>
                                    <form th:action="@{/restaurant/orders/update-status/{id}(id=${order.id})}" method="post" class="d-inline">
                                        <select name="status" class="form-select form-select-sm" style="width: auto;"
                                                onchange="this.form.submit()"
                                                th:disabled="${order.status == 'DELIVERED' || order.status == 'CANCELLED'}">
                                            <option value="PENDING" th:selected="${order.status == 'PENDING'}">Pending</option>
                                            <option value="PREPARING" th:selected="${order.status == 'PREPARING'}">Preparing</option>
                                            <option value="DELIVERED" th:selected="${order.status == 'DELIVERED'}">Delivered</option>
                                            <option value="CANCELLED" th:selected="${order.status == 'CANCELLED'}">Cancelled</option>
                                        </select>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Menu Management Section -->
            <div class="card shadow">
                <div class="card-header py-3 d-flex justify-content-between align-items-center">
                    <h6 class="m-0 fw-bold text-primary">
                        <i class="fas fa-clipboard-list me-2"></i>Menu Management
                    </h6>
                    <div class="d-flex gap-2">
                        <form th:action="@{/restaurant}" method="get" class="d-flex">
                            <input type="text" name="menuSearch" class="form-control form-control-sm" placeholder="Search..." th:value="${currentMenuSearch}">
                            <button type="submit" class="btn btn-sm btn-outline-secondary ms-1">
                                <i class="fas fa-search"></i>
                            </button>
                        </form>
                        <a th:href="@{/restaurant/menu-items/new}" class="btn btn-primary btn-sm">
                            <i class="fas fa-plus me-1"></i>Add Item
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle">
                            <thead class="table-light">
                            <tr>
                                <th>Image</th>
                                <th>Name</th>
                                <th>Description</th>
                                <th>Category</th>
                                <th>Price</th>
                                <th>Available</th>
                                <th>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:if="${menuItems == null || #lists.isEmpty(menuItems)}">
                                <td colspan="7" class="text-center py-4">
                                    <i class="fas fa-utensils fa-3x text-muted"></i>
                                    <p class="text-muted mt-2">No menu items found</p>
                                </td>
                            </tr>
                            <tr th:each="item : ${menuItems}">
                                <td>
                                    <img th:src="${item.imageUrl != null ? item.imageUrl : 'https://via.placeholder.com/60'}"
                                         class="menu-item-thumbnail" th:alt="${item.name}"
                                         onerror="this.src='https://via.placeholder.com/60?text=No+Image'">
                                </td>
                                <td><strong th:text="${item.name}"></strong></td>
                                <td><span th:text="${item.description != null ? #strings.abbreviate(item.description, 50) : 'No description'}"></span></td>
                                <td>
                                    <span class="badge category-badge"
                                          th:classappend="${item.category == 'Appetizers' ? 'badge-appetizers' :
                                                          (item.category == 'Main Courses' ? 'badge-main' :
                                                          (item.category == 'Desserts' ? 'badge-desserts' : 'badge-beverages'))}"
                                          th:text="${item.category}"></span>
                                </td>
                                <td><strong class="text-success">$<span th:text="${#numbers.formatDecimal(item.price, 0, 2)}"></span></strong></td>
                                <td>
                                    <form th:action="@{/restaurant/menu-items/toggle-availability/{id}(id=${item.id})}" method="post">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox"
                                                   th:checked="${item.available}"
                                                   onchange="this.form.submit()">
                                        </div>
                                    </form>
                                </td>
                                <td>
                                    <a th:href="@{/restaurant/menu-items/edit/{id}(id=${item.id})}" class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <form th:action="@{/restaurant/menu-items/delete/{id}(id=${item.id})}" method="post" class="d-inline"
                                          onsubmit="return confirm('Delete this item?');">
                                        <button type="submit" class="btn btn-sm btn-outline-danger">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>